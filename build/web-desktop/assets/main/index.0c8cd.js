window.__require=function t(o,n,e){function c(i,r){if(!n[i]){if(!o[i]){var s=i.split("/");if(s=s[s.length-1],!o[s]){var l="function"==typeof __require&&__require;if(!r&&l)return l(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+i+"'")}i=s}var h=n[i]={exports:{}};o[i][0].call(h.exports,function(t){return c(o[i][1][t]||t)},h,h.exports,t,o,n,e)}return n[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<e.length;i++)c(e[i]);return c}({anim_end_del:[function(t,o){"use strict";cc._RF.push(o,"47930NHZTdBG4hWa3ETICNF","anim_end_del"),cc.Class({extends:cc.Component,onAnimCompleted:function(){this.node.destroy()}}),cc._RF.pop()},{}],apply:[function(t,o){"use strict";cc._RF.push(o,"a2c30B4UKVDC5JLMMBaYToT","apply"),cc.Class({extends:cc.Component,properties:{button:cc.Button},onLoad:function(){this.node.on("click",this.callback,this)},callback:function(t){var o=t.node.parent.getComponent("config");o.countWidth=+cc.find("Canvas/N_count").getComponent(cc.EditBox).string,o.countHeight=+cc.find("Canvas/M_count").getComponent(cc.EditBox).string,o.colorsCount=+cc.find("Canvas/C_count").getComponent(cc.EditBox).string,o.colorsCount>5&&(o.colorsCount=5,cc.find("Canvas/C_count").getComponent(cc.EditBox).string="5"),o.minCountToBlast=+cc.find("Canvas/K_count").getComponent(cc.EditBox).string,o.scoreToWin=+cc.find("Canvas/X_count").getComponent(cc.EditBox).string,o.defaultTurns=+cc.find("Canvas/Y_count").getComponent(cc.EditBox).string,o.bombCount=+cc.find("Canvas/Bomb_count").getComponent(cc.EditBox).string,o.bombRadius=+cc.find("Canvas/BR_count").getComponent(cc.EditBox).string,o.boxHeight=(cc.find("Canvas/area_battle").height-20)/o.countHeight,o.boxWidth=(cc.find("Canvas/area_battle").width-20)/o.countWidth,cc.find("Canvas/area_battle").removeAllChildren(),o.ScoreCount=0,o.countTurns=o.defaultTurns,cc.find("Canvas/shadow").x=1e3,cc.find("Canvas/gameEnd").y=500,cc.find("Canvas/start_new").y=500,cc.find("Canvas/area_battle").getComponent("game").make_battle_arena_new(),cc.find("Canvas/area_battle").getComponent("game").gameOn=!0,cc.find("Canvas/area_battle").getComponent("game").enabledT=cc.find("Canvas/area_battle").getComponent("game").gameOn},start:function(){}}),cc._RF.pop()},{}],block:[function(t,o){"use strict";cc._RF.push(o,"206f90TK/BCAoZuf0HMW/Pz","block"),cc.Class({extends:cc.Component,properties:{colorBox:1,coord_x:-1,coord_y:-1},moveToLocation:function(t,o){(0,cc.tween)(this.node).to(.7,{position:cc.v2(t,o)}).start()},onLoad:function(){this.node.getComponent(cc.Sprite).node.on("mousedown",function(){var t=this.node.parent.parent.getComponent("config"),o=this.node.parent.getComponent("game");if(this.node.parent.getComponent("game").enabledT&&!this.node.parent.getComponent("game").isStart){var n=Math.floor((this.node.x-10-t.boxWidth/2)/t.boxWidth),e=Math.floor((this.node.y-10-t.boxHeight/2)/t.boxHeight);o.makeBlast(n,e)}},this)},start:function(){}}),cc._RF.pop()},{}],config:[function(t,o){"use strict";cc._RF.push(o,"fff294A6eZHt6m8rObIyC6O","config"),cc.Class({extends:cc.Component,properties:{colorsCount:5,countWidth:9,countHeight:9,countTurns:{default:30},minCountToBlast:2,defaultTurns:30,ScoreCount:0,boxHeight:50,boxWidth:50,scoreToWin:5e4,bombCount:5,bombRadius:1,maxMixTurn:3},onLoad:function(){this.countTurns=this.defaultTurns,cc.find("area_battle",this.node).getComponent("game").isStart?(cc.find("area_time/time",this.node).getComponent(cc.Label).string="Turns:\n\u221e",cc.find("area_time/score",this.node).getComponent(cc.Label).string="\u221e"):(cc.find("area_time/time",this.node).getComponent(cc.Label).string="Turns:\n"+this.countTurns,cc.find("area_time/score",this.node).getComponent(cc.Label).string=this.ScoreCount,cc.find("N_count",this.node).getComponent(cc.EditBox).string=this.countWidth,cc.find("M_count",this.node).getComponent(cc.EditBox).string=this.countHeight,cc.find("C_count",this.node).getComponent(cc.EditBox).string=this.colorsCount,cc.find("K_count",this.node).getComponent(cc.EditBox).string=this.minCountToBlast,cc.find("X_count",this.node).getComponent(cc.EditBox).string=this.scoreToWin,cc.find("Y_count",this.node).getComponent(cc.EditBox).string=this.defaultTurns,cc.find("Bomb_count",this.node).getComponent(cc.EditBox).string=this.bombCount,cc.find("BR_count",this.node).getComponent(cc.EditBox).string=this.bombRadius),this.boxHeight=(cc.find("area_battle",this.node).height-20)/this.countHeight,this.boxWidth=(cc.find("area_battle",this.node).width-20)/this.countWidth},start:function(){},update:function(){cc.find("area_battle",this.node).getComponent("game").isStart||(cc.find("area_time/time",this.node).getComponent(cc.Label).string="Turns:\n"+this.countTurns,cc.find("area_time/score",this.node).getComponent(cc.Label).string=this.ScoreCount)}}),cc._RF.pop()},{}],game:[function(t,o){"use strict";cc._RF.push(o,"60ac0wb5GROmJzfcB2rxYjA","game"),cc.Class({extends:cc.Component,properties:{blocksPrefab:{default:null,type:cc.Prefab},arrBox:{default:[]},isStart:!1,enabledT:!0,gameOn:!0,arrToDel:[],arrToCheck:[],bombClick:{default:{},i:-1,j:-1},willBomb:!1},makeColorN:function(t){var o=t;switch(o.colorBox){case 1:cc.resources.load("blocks/block_blue",cc.SpriteFrame,null,function(t,n){o.getComponent(cc.Sprite).spriteFrame=n});break;case 2:cc.resources.load("blocks/block_red",cc.SpriteFrame,null,function(t,n){o.getComponent(cc.Sprite).spriteFrame=n});break;case 3:cc.resources.load("blocks/block_yellow",cc.SpriteFrame,null,function(t,n){o.getComponent(cc.Sprite).spriteFrame=n});break;case 4:cc.resources.load("blocks/block_green",cc.SpriteFrame,null,function(t,n){o.getComponent(cc.Sprite).spriteFrame=n});break;case 5:cc.resources.load("blocks/block_purple",cc.SpriteFrame,null,function(t,n){o.getComponent(cc.Sprite).spriteFrame=n});break;case 6:cc.resources.load("blocks/bomb",cc.SpriteFrame,null,function(t,n){o.getComponent(cc.Sprite).spriteFrame=n,o.getComponent(cc.Animation).play("bomb")})}},createNewBox:function(t,o,n){var e=cc.instantiate(this.blocksPrefab),c=this.node.parent.getComponent("config");6==n?this.arrBox[t].splice(o,0,e):this.arrBox[t][o]=e,this.node.addChild(this.arrBox[t][o]),this.arrBox[t][o].colorBox=n,this.arrBox[t][o].coord_x=t,this.arrBox[t][o].coord_y=o,this.arrBox[t][o].zIndex=c.countHeight-o,this.arrBox[t][o].x=t*c.boxWidth+c.boxWidth/2+10,this.arrBox[t][o].y=6==n?this.bombClick.j*c.boxHeight+c.boxHeight/2+10:this.node.height,this.makeColorN(this.arrBox[t][o]),this.arrBox[t][o].height=c.boxHeight,this.arrBox[t][o].width=c.boxWidth},make_battle_arena_new:function(){var t=this.node.parent.getComponent("config");this.arrBox=[];for(var o=0;o<t.countWidth;o++){this.arrBox[o]||(this.arrBox[o]=[]);for(var n=0;n<t.countHeight;n++)this.arrBox[o][n]=null}for(t=this.node.parent.getComponent("config"),o=0;o<t.countWidth;o++)for(n=0;n<t.countHeight;n++){var e=Math.floor(Math.random()*t.colorsCount)+1;this.createNewBox(o,n,e),this.arrBox[o][n].getComponent("block").moveToLocation(this.arrBox[o][n].x,n*t.boxHeight+t.boxHeight/2+10)}this.checkHaveTurns()||this.mix_battle_area(1)},mix_battle_area:function(t){var o=this.node.parent.getComponent("config");if(this.makeEndOFGame(0),t>o.maxMixTurn)return this.makeLose(),0;for(var n,e,c=this.arrBox,a=[],i=0;i<o.countWidth;i++)a[i]=[];for(i=0;i<o.countWidth;i++)for(var r=0;r<o.countHeight;r++)n=Math.floor(Math.random()*c.length),e=Math.floor(Math.random()*c[n].length),a[i].push(c[n][e]),c[n].splice(e,1),0==c[n].length&&c.splice(n,1);for(i=0;i<o.countWidth;i++)for(this.arrBox.push([]),r=0;r<o.countHeight;r++)this.arrBox[i].push(a[i][r]),this.arrBox[i][r].coord_x=i,this.arrBox[i][r].coord_y=r,this.arrBox[i][r].getComponent("block").moveToLocation(i*o.boxWidth+o.boxWidth/2+10,r*o.boxHeight+o.boxHeight/2+10);this.checkHaveTurns()||this.mix_battle_area(t+1)},checkSimpleTurns:function(t,o,n,e,c){var a=this.node.parent.getComponent("config");return++c>=a.minCountToBlast?c:6==this.arrBox[t][o].colorBox?c=a.minCountToBlast:(t-1>=0&&(this.arrBox[t-1][o].colorBox!=this.arrBox[t][o].colorBox||t-1==n&&o==e||(c=this.checkSimpleTurns(t-1,o,t,o,c))),t+1<a.countWidth&&(this.arrBox[t+1][o].colorBox!=this.arrBox[t][o].colorBox||t+1==n&&o==e||(c=this.checkSimpleTurns(t+1,o,t,o,c))),o-1>=0&&(this.arrBox[t][o-1].colorBox!=this.arrBox[t][o].colorBox||t==n&&o-1==e||(c=this.checkSimpleTurns(t,o-1,t,o,c))),o+1<a.countHeight&&(this.arrBox[t][o+1].colorBox!=this.arrBox[t][o].colorBox||t==n&&o+1==e||(c=this.checkSimpleTurns(t,o+1,t,o,c))),c)},checkHaveTurns:function(){for(var t=this.node.parent.getComponent("config"),o=this.arrBox,n=0;n<o.length;n++)for(var e=0;e<o[n].length;e++)if(this.checkSimpleTurns(n,e,n,e,0)>=t.minCountToBlast)return 1;return 0},checkToDel:function(t,o){for(var n=0;n<this.arrToDel.length;n++)if(this.arrToDel[n].i==t&&this.arrToDel[n].j==o)return 1;return 0},simple_blast:function(t,o,n,e,c){var a=this.node.parent.getComponent("config");if(c>a.boxHeight*a.boxWidth)return console.log("recurtion"),0;var i=this.arrBox[t][o];if(this.checkToDel(t,o))return 0;c++,this.arrToDel.push({i:t,j:o}),t-1>=0&&(this.arrBox[t-1][o].colorBox!=i.colorBox||t-1==n&&o==e||this.simple_blast(t-1,o,t,o,c)),t+1<a.countWidth&&(this.arrBox[t+1][o].colorBox!=i.colorBox||t+1==n&&o==e||this.simple_blast(t+1,o,t,o,c)),o-1>=0&&(this.arrBox[t][o-1].colorBox!=i.colorBox||t==n&&o-1==e||this.simple_blast(t,o-1,t,o,c)),o+1<a.countHeight&&(this.arrBox[t][o+1].colorBox!=i.colorBox||t==n&&o+1==e||this.simple_blast(t,o+1,t,o,c))},bomb_blast:function(t,o){var n=this.node.parent.getComponent("config"),e=this.arrBox,c=this.arrToDel;c.push({i:t,j:o});for(var a=t-n.bombRadius;a<=t+n.bombRadius;a++)for(var i=o-n.bombRadius;i<=o+n.bombRadius;i++)a<n.countWidth&&a>-1&&i>-1&&i<n.countHeight&&(this.checkToDel(a,i)||(c.push({i:a,j:i}),6==e[a][i].colorBox&&this.bomb_blast(a,i)))},find_box_to_blast:function(t,o){var n=this.node.parent.getComponent("config");switch(this.arrToDel=[],this.arrBox[t][o].colorBox){case 6:this.bomb_blast(t,o);break;default:this.simple_blast(t,o,t,o,0)}return this.arrToDel.length<n.minCountToBlast&&6!=this.arrBox[t][o].colorBox?(this.arrToDel=[],0):1},afterBlastMove:function(){for(var t=this.node.parent.getComponent("config"),o=-1,n=0;n<this.arrToDel.length;n++){var e;if(o<(a=this.arrToDel[n]).i){o=a.i;for(var c=a.j;c<this.arrBox[a.i].length;c++)this.arrBox[a.i][c].coord_y=c,this.arrBox[a.i][c].zIndex=t.countHeight-c}this.willBomb&&this.bombClick.i==a.i?(e=6,this.createNewBox(a.i,a.j,e),this.willBomb=!1):(e=Math.floor(Math.random()*t.colorsCount)+1,this.createNewBox(a.i,this.arrBox[a.i].length,e))}var a=-1;for(n=0;n<this.arrToDel.length;n++)if(a<this.arrToDel[n].i)for(a=this.arrToDel[n].i,c=this.arrToDel[n].j;c<t.countHeight;c++)this.arrBox[a][c].getComponent("block").moveToLocation(this.arrBox[a][c].x,c*t.boxHeight+t.boxHeight/2+10)},getScore:function(t){return this.node.parent.getComponent("config"),100*t},makeBlast:function(t,o){var n=this,e=n.node.parent.getComponent("config");n.enabledT=!1;var c=!1,a=n.getScore(n.arrBox[t][o].colorBox),i=0,r=6==n.arrBox[t][o].colorBox;n.find_box_to_blast(t,o),n.arrToDel.sort(function(t,o){return t.i<o.i?-1:t.i!=o.i?1:t.j<o.j?-1:void 0}),6!=n.arrBox[t][o].colorBox&&n.arrToDel.length>=e.bombCount?(n.willBomb=!0,n.bombClick={i:t,j:o}):n.willBomb=!1;for(var s=n.arrToDel.length-1;s>=0;s--){var l=n.arrToDel[s].i,h=n.arrToDel[s].j,u=n.arrBox[l][h];n.arrBox[l].splice(h,1),i+=n.getScore(u.colorBox),n.destroyFire(u),c=!0}if(c){if(n.afterBlastMove(),a*=Math.floor(Math.pow(1.5,n.arrToDel.length-1)),e.ScoreCount+=r?i:a,u=e,e.ScoreCount>=e.scoreToWin)return n.makeEndOFGame(1),0;if(e.countTurns--,0==e.countTurns)return n.makeEndOFGame(-1),0}n.checkHaveTurns()||n.mix_battle_area(1),setTimeout(function(){n.enabledT=n.gameOn},700)},makeEndOFGame:function(t){var o=this;switch(cc.find("Canvas/shadow").x=0,cc.find("Canvas/gameEnd").y=0,cc.find("Canvas/start_new").y=-150,t){case-1:cc.find("Canvas/gameEnd").getComponent(cc.RichText).string="<outline color=black width=4>GAME\nOVER</outline>",o.gameOn=!1,o.enabledT=o.gameOn;break;case 1:cc.find("Canvas/gameEnd").getComponent(cc.RichText).string="<outline color=black width=4>you\nWIN!!!</outline>",o.gameOn=!1,o.enabledT=o.gameOn;break;case 0:cc.find("Canvas/gameEnd").getComponent(cc.RichText).string="<outline color=black width=4>NO TURNS</outline>",cc.find("Canvas/start_new").y=500,o.enabledT=o.gameOn,setTimeout(function(){o.enabledT=o.gameOn,cc.find("Canvas/shadow").x=1e3,cc.find("Canvas/gameEnd").y=500},1e3)}},destroyFire:function(t){var o=this.node.parent.getComponent("config"),n=t.getComponent(cc.Animation);t.zIndex=10,6==t.colorBox?(cc.tween(t).to(.3,{scaleX:1+2*o.bombRadius,scaleY:1+2*o.bombRadius}).start(),n.play("blast")):n.play("fire")},onLoad:function(){this.make_battle_arena_new()},start:function(){}}),cc._RF.pop()},{}],mixit:[function(t,o){"use strict";cc._RF.push(o,"cd408cigdBAmaaX2YWJz0wv","mixit"),cc.Class({extends:cc.Component,properties:{button:cc.Button},onLoad:function(){this.node.on("click",this.callback,this)},callback:function(t){t.node.parent.getComponent("config"),cc.find("Canvas/area_battle").getComponent("game").gameOn&&cc.find("Canvas/area_battle").getComponent("game").mix_battle_area()},start:function(){}}),cc._RF.pop()},{}],restart:[function(t,o){"use strict";cc._RF.push(o,"7b501GNKuFHRYyNIB8hhcrS","restart"),cc.Class({extends:cc.Component,properties:{button:cc.Button},onLoad:function(){this.node.on("click",this.callback,this)},callback:function(t){var o=t.node.parent.getComponent("config");cc.find("Canvas/area_battle").getComponent("game").gameOn&&(cc.find("Canvas/area_battle").removeAllChildren(),o.ScoreCount=0,o.countTurns=o.defaultTurns,cc.find("Canvas/shadow").x=1e3,cc.find("Canvas/gameEnd").y=500,cc.find("Canvas/area_battle").getComponent("game").make_battle_arena_new(),cc.find("Canvas/area_battle").getComponent("game").gameOn=!0,cc.find("Canvas/area_battle").getComponent("game").enabledT=cc.find("Canvas/area_battle").getComponent("game").gameOn)},start:function(){}}),cc._RF.pop()},{}],start_new_game:[function(t,o){"use strict";cc._RF.push(o,"b237eJWWBJCi7/Z+9DnG45R","start_new_game"),cc.Class({extends:cc.Component,properties:{button:cc.Button},onLoad:function(){this.node.on("click",this.callback,this)},callback:function(t){var o=t,n=o.node.parent.getComponent("config");cc.find("Canvas/area_battle").getComponent("game").gameOn||(cc.find("Canvas/area_battle").removeAllChildren(),n.ScoreCount=0,n.countTurns=n.defaultTurns,cc.find("Canvas/shadow").x=1e3,cc.find("Canvas/gameEnd").y=500,cc.find("Canvas/area_battle").getComponent("game").make_battle_arena_new(),cc.find("Canvas/area_battle").getComponent("game").gameOn=!0,cc.find("Canvas/area_battle").getComponent("game").enabledT=cc.find("Canvas/area_battle").getComponent("game").gameOn,o.node.y=500)},start:function(){}}),cc._RF.pop()},{}],start:[function(t,o){"use strict";cc._RF.push(o,"4960ar8Wj1P+7KxMMbrc/lv","start"),cc.Class({extends:cc.Component,properties:{button:cc.Button},onLoad:function(){this.node.on("click",this.callback,this),cc.find("Canvas/area_battle").getComponent("game").isStart=!0},callback:function(){cc.director.loadScene("main")},start:function(){}}),cc._RF.pop()},{}]},{},["anim_end_del","apply","block","config","game","mixit","restart","start","start_new_game"]);